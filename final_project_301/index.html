<!DOCTYPE html>
<html>
<head>
	<title> Bookmark </title>

	<meta charset="UTF-8">
	<link rel="shortcut icon" type="image/png" href="links/logo-icon.png">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- jQuery -->
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

	<!-- Modal -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>

	<!-- CSS -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/index.css">

	<!-- Font -->
	<link rel="stylesheet" href="https://use.typekit.net/nad3zzz.css">

	<!-- Icons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<meta name="description" content="Bookmark is a virtual library. Discover new reads and build your collection.">

</head>
<body>

	<header>
		<div id="banner">
			<span class="banner-div">
				<a href="index.html"><img src="links/logo-white.png" alt="logo"></a>
			</span>

			<h1><a href="index.html"> Bookmark </a></h1>

			<p class="banner-div">
				5931 Franklin Avenue <br>
				Los Angeles, California, 90028
				<a href="index.html" target="_blank" class="fa fa-facebook"></a>
				<a href="index.html" target="_blank" class="fa fa-instagram"></a>
				<a href="index.html" target="_blank" class="fa fa-twitter"></a>
			</p>
		</div>
	</header>

	<div id="nav-header">
		<div id="links">
			<a href="index.html"> Home </a>
			<a href="about.html"> About Us </a>
			<a href="library.html"> The Library </a>
			<a href="list.html"> Your Lists </a>
		</div>
	</div>

	<section id="index-intro">
		<div id="intro-img">
			<img src="links/1.jpg" alt="bookstore">
			<div id="intro-text">
				<h1> Welcome to Bookmark </h1>
				<p> We hope you enjoy your time here, and happy reading! </p>
				<p id="down-arrow"> &darr; </p>
			</div>
		</div>
	</section>

	<section id="index-browse">
		<h2> In need of a good read? Browse the daily selection. </h2>

		<div id="browse-error"></div>

		<div class="genre-row">
			<h3> New in Fantasy</h3>

			<div class="daily" id="fantasy">
				
			</div>
		</div>

		<hr>

		<div class="genre-row">
			<h3> New in Graphic Novels </h3>

			<div class="daily" id="graphic-novels">
				
			</div>
		</div>

		<hr>

		<div class="genre-row">
			<h3> New in Biographies/Autobiographies </h3>

			<div class="daily" id="biographies">
				
			</div>
		</div>

		<a href="library.html" class="button"> Head to the Library </a>
	</section>

	<section id="index-about">
		<div id="about-img">
			<img src="links/2.jpg" alt="bookshelf">
		</div>

		<div id="about-text">
			<h2> Our Story </h2>
			<p> Bookmark was created in 2019 as a virtual book shop. Here, readers get the opportunity to look through a directory of published literature for the perfect book, keep up to date on new releases, and curate and customize their collection of books for any occassion. Create a world of literature unique to you. </p>
			<a href="about.html" class="button"> More About Us </a>
		</div>
	</section>


	<section id="index-list">
		<h2> Your Personal List </h2>

		<p> Create lists of books for every category, purpose, personâ€”you name it. </p>

		<a href="list.html" class="button"> Go to List </a>
	</section>


	<footer>
		<div id="subscription">
			<div>
				<h3> Stay Updated </h3>
				<p> Join the mailing list to get updates about new releases and upcoming events. </p>
			</div>

			<form id="email-form">
				<label for="sub-email"> Email: </label>
				<input id="sub-email" type="text" name="email" placeholder="example@email.com">
				<button class="button" type="submit"> Join </button>
				<p class="form-msg" id="subscription-msg">&nbsp;</p>
			</form>
		</div>

		<div id="nav-footer">
			<div id="nav-logo">
				<a href="index.html">
					<img src="links/logo.png" alt="logo">
				</a>
				<a href="index.html">
					<h1> Bookmark </h1>
				</a>
			</div>

			<div class="nav-list">
				<h3> Contact Us </h3>
					5931 Franklin Avenue <br>
					Los Angeles, California, 90028 <br>
					+1 (213) 823-389 <br>
					inquiries@bookmark.com
			</div>

			<div class="nav-list">
				<h3> Social Media </h3>
				<a href="index.html" target="_blank"> Instagram </a>
				<a href="index.html" target="_blank"> Twitter </a>
				<a href="index.html" target="_blank"> Facebook </a>
			</div>
		</div>

		<p id="copyright"> Copyright &copy; 2019 Bookmark. All Rights Reserved. <a href="project_summary.html" target="_blank"> Project Summary </a></p>
	</footer>



	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

	<script src="main.js"></script>

	<script src="handlebars-v4.5.3.js"></script>

	<script type="text/x-handlebars-template" id="handlebarsIndex">

		{{#each .}}
		<a class="modal-button open-modal daily-pick" rel="modal:open" href="#{{id}}">
			<div class="img">

				{{#if volumeInfo.imageLinks.thumbnail}}
					<img src="{{volumeInfo.imageLinks.thumbnail}}" alt="{{volumeInfo.title}} Cover">
				{{else}}
					<img src="links/unavailable2.png">
				{{/if}}

			</div>
			<h4> {{volumeInfo.title}} </h4>
			<span> {{volumeInfo.authors.[0]}} </span>

			{{#if volumeInfo.averageRating}}
				<span> Rating: {{volumeInfo.averageRating}} &starf; </span>
			{{else}}
				<span> Rating: Unavailable </span>
			{{/if}}

			<div><span class="read-more"> Read More </span></div>
		</a>

		<div class="modal" id="{{id}}">
			<h3> {{volumeInfo.title}} </h3>
			<div class="modal-flex">
				<div class="modal-img">
					{{#if volumeInfo.imageLinks.thumbnail}}
						<img src="{{volumeInfo.imageLinks.thumbnail}}" alt="{{volumeInfo.title}} Cover">
					{{else}}
						<img src="links/unavailable2.png">
					{{/if}}
				</div>

				<div class="modal-brief">
					{{#if volumeInfo.averageRating}}
						<p><span class="rating-button"> <span class="rating">Rating:</span> {{volumeInfo.averageRating}} &starf; </span></p>
					{{else}}
						<p><span class="rating-button"> <span class="rating">Rating:</span> Unavailable </span></p>
					{{/if}}

					<div class="modal-grey">
						<h4> Description </h4>
						{{#if volumeInfo.description}}
							<p> {{volumeInfo.description}} </p>
						{{else}}
							<p> Description unavailable. </p>
						{{/if}}
					</div>

					<p> <span class="rating">Author:</span>
						{{#each volumeInfo.authors}}{{#if @index}}, {{/if}}{{this}}{{/each}}
					</p>
					<p> <span class="rating">Date Published:</span> {{volumeInfo.publishedDate}} </p>
					
					{{#if volumeInfo.categories}}
						<p> <span class="rating">Genre:</span> {{volumeInfo.categories}} </p>
					{{else}}
						<p> <span class="rating">Genre:</span> Unavailable </p>
					{{/if}}

					{{#if volumeInfo.pageCount}}
						<p> <span class="rating">Page Count:</span> {{volumeInfo.pageCount}} </p>
					{{else}}
						<p> <span class="rating">Page Count: Unavailable</span> </p>
					{{/if}}
					
					{{#if volumeInfo.industryIdentifiers.0.identifier}}
						<p> <span class="rating">ISBN:</span> {{volumeInfo.industryIdentifiers.0.identifier}} </p>
					{{else}}
						<p> <span class="rating">ISBN:</span> Unavailable </p>
					{{/if}}
					
					<hr>

					<a class="button" href="{{volumeInfo.infoLink}}" target="_blank"> Find on Google Books </a>
					<p class="savebtn button" bookid="{{id}}"> Save Book </p>
					<a class="button" href="list.html"> Go to List </a>
				</div>
			</div>
		</div>
		{{/each}}

	</script>

	<script>

		var height;

		$(window).scroll(function() {
			height = $('#intro-img').height() - 141;
			if ($(this).scrollTop() > height) {
				$("#nav-header").addClass("active");
			} else {
				$("#nav-header").removeClass("active");
			}
		});

		document.querySelector("#down-arrow").onclick = function() {
			height = $('#intro-img').height() - 140;
			window.scroll({
			  top: height,
			  left: 0, 
			  behavior: 'smooth'
			});
		}

		$.modal.defaults = {
			showClose: false,
			clickClose: true,
			escapeClose: true,
			fadeDuration: 150,
		}

		var urlFantasy = "https://www.googleapis.com/books/v1/volumes?q=+subject:fantasy&orderBy=newest&callback=myCallbackFantasy&key=AIzaSyDKLl1iPuyvCVZx7beAs8nL_VWbJxit3Pk&maxResults=6&langRestrict=en";
		var urlGraphicNovel = "https://www.googleapis.com/books/v1/volumes?q=+subject:graphic+novel&orderBy=newest&callback=myCallbackGNovel&key=AIzaSyDKLl1iPuyvCVZx7beAs8nL_VWbJxit3Pk&maxResults=6&langRestrict=en";
		var urlBiography = "https://www.googleapis.com/books/v1/volumes?q=+subject:biography&orderBy=newest&callback=myCallbackBiographies&key=AIzaSyDKLl1iPuyvCVZx7beAs8nL_VWbJxit3Pk&maxResults=6&langRestrict=en";

		var genreLink = [urlFantasy, urlGraphicNovel, urlBiography];

		for (y = 0; y < genreLink.length; y++) {
			var script = document.createElement("script");
			script.src = genreLink[y];
			document.body.appendChild(script);
		}

		var fantasyBooks;
		var gNovelBooks;
		var biographyBooks;

		var books;

		if (localStorage.getItem("books") === null) {
			books = [];
		} else {
			books = JSON.parse(localStorage.getItem("books"));
		}

		var undefinedError = document.createElement("p");
		undefinedError.classList.add("undefined-error");
		undefinedError.innerHTML = "There has been an error. Check back again later!";

		function myCallbackFantasy(data) {
			fantasyBooks = data.items;

			if (fantasyBooks == undefined) {
				document.querySelector("#browse-error").appendChild(undefinedError);
			} else {
				var source = document.querySelector("#handlebarsIndex").innerHTML;
				var template = Handlebars.compile(source);

				document.querySelector("#fantasy").innerHTML = template(data.items);

				var saveBtn = document.querySelectorAll("#fantasy .savebtn");
				for (var i = 0; i < saveBtn.length; i++) {
					var saved = false;

					saveBtn[i].setAttribute("index", i);

					for (var k = 0; k < books.length; k++) {
						if (saveBtn[i].getAttribute('bookid') == books[k].id) {
							saveBtn[i].innerHTML = "Book Already Saved";
						}
					}

					saveBtn[i].onclick = function() {
						var j = this.getAttribute("index");
		
						var savedBook = fantasyBooks[j].id;

						for (m = 0; m < books.length; m++) {
							var present = books[m].id == savedBook;
							if (present) {
								break;
							}
						}

						if (present) {
							saveBtn[j].innerHTML = "Book Already Saved";
						} else {
							books.push(fantasyBooks[j]);
							saveBtn[j].innerHTML = "Book Saved";
						}

						localStorage.setItem("books", JSON.stringify(books));
					}
				}
			}
		}

		function myCallbackGNovel(data) {
			gNovelBooks = data.items;

			if (gNovelBooks == undefined) {
				document.querySelector("#browse-error").appendChild(undefinedError);
			} else {
				var source = document.querySelector("#handlebarsIndex").innerHTML;
				var template = Handlebars.compile(source);

				document.querySelector("#graphic-novels").innerHTML = template(data.items);

				var saveBtn = document.querySelectorAll("#graphic-novels .savebtn");
				for (var i = 0; i < saveBtn.length; i++) {
					var saved = false;

					saveBtn[i].setAttribute("index", i);

					for (var k = 0; k < books.length; k++) {
						if (saveBtn[i].getAttribute('bookid') == books[k].id) {
							saveBtn[i].innerHTML = "Book Already Saved";
						}
					}

					saveBtn[i].onclick = function() {
						var j = this.getAttribute("index");

						var savedBook = gNovelBooks[j].id;

						for (m = 0; m < books.length; m++) {
							var present = books[m].id == savedBook;
							if (present) {
								break;
							}
						}

						if (present) {
							saveBtn[j].innerHTML = "Book Already Saved";
						} else {
							books.push(gNovelBooks[j]);
							saveBtn[j].innerHTML = "Book Saved";
						}

						localStorage.setItem("books", JSON.stringify(books));
					}
				}
			}
		}

		function myCallbackBiographies(data) {
			biographyBooks = data.items;

			if (biographyBooks == undefined) {
				document.querySelector("#browse-error").appendChild(undefinedError);
			} else {
				var source = document.querySelector("#handlebarsIndex").innerHTML;
				var template = Handlebars.compile(source);

				document.querySelector("#biographies").innerHTML = template(data.items);

				var saveBtn = document.querySelectorAll("#biographies .savebtn");
				for (var i = 0; i < saveBtn.length; i++) {
					var saved = false;

					saveBtn[i].setAttribute("index", i);

					for (var k = 0; k < books.length; k++) {
						if (saveBtn[i].getAttribute('bookid') == books[k].id) {
							saveBtn[i].innerHTML = "Book Already Saved";
						}
					}

					saveBtn[i].onclick = function() {
						var j = this.getAttribute("index");

						var savedBook = biographyBooks[j].id;

						for (m = 0; m < books.length; m++) {
							var present = books[m].id == savedBook;
							if (present) {
								break;
							}
						}

						if (present) {
							saveBtn[j].innerHTML = "Book Already Saved";
						} else {
							books.push(biographyBooks[j]);
							saveBtn[j].innerHTML = "Book Saved";
						}

						localStorage.setItem("books", JSON.stringify(books));
					}
				}
			}
		}

	</script>

</body>
</html>